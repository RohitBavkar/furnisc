generator client {
  provider        = "prisma-client"
  output          = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
  schemas  = ["furnexa"]
}

model Product {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  description String?
  price       Float
  stock       Int      @default(0)
  featured    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  categoryId  String?
  category    Category? @relation(fields: [categoryId], references: [id])
  
  images      ProductImage[]
  orderItems  OrderItem[]
  
  // Metadata for AI
  color       String?
  material    String?
  
  @@index([categoryId])
  @@index([slug])
  @@schema("furnexa")
}

model ProductImage {
  id        String  @id @default(cuid())
  url       String
  altText   String?
  order     Int     @default(0)
  
  productId String
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  @@index([productId])
  @@schema("furnexa")
}

model Category {
  id          String    @id @default(cuid())
  title       String
  slug        String    @unique
  description String?
  imageUrl    String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  products    Product[]
  
  @@index([slug])
  @@schema("furnexa")
}

model Customer {
  id              String   @id @default(cuid())
  clerkUserId     String   @unique
  email           String   @unique
  name            String
  stripeCustomerId String? @unique
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  orders          Order[]
  
  @@index([clerkUserId])
  @@index([email])
  @@schema("furnexa")
}

model Order {
  id              String   @id @default(cuid())
  orderNumber     String   @unique
  total           Float
  status          String   @default("paid")
  stripePaymentId String?  @unique
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  customerId      String
  customer        Customer @relation(fields: [customerId], references: [id])
  
  items           OrderItem[]
  
  @@index([customerId])
  @@index([orderNumber])
  @@index([stripePaymentId])
  @@schema("furnexa")
}

model OrderItem {
  id              String @id @default(cuid())
  quantity        Int
  priceAtPurchase Float
  
  orderId         String
  order           Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  
  productId       String
  product         Product @relation(fields: [productId], references: [id])
  
  @@index([orderId])
  @@index([productId])
  @@schema("furnexa")
}